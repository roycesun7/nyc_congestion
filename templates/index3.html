<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Congestion Dashboard</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
</head>

<body>
  <div class="container mt-4">
    <h1 class="mb-4">Congestion Insights</h1>

    <div class="row mb-3">
      <!-- Select Date -->
      <div class="col-md-3">
        <label for="date" class="form-label"><b>Select Date</b></label>
        <input type="date" id="date" class="form-control" />
      </div>

      <!-- Select Hour -->
      <div class="col-md-3">
        <label for="hour" class="form-label"><b>Time of Day (Hour)</b></label>
        <select id="hour" class="form-select">
          <option value="all">All Hours</option>
          <!-- Add hours manually -->
          <script>
            window.addEventListener("DOMContentLoaded", () => {
              const hourSelect = document.getElementById("hour");
              for (let h = 0; h < 24; h++) {
                const option = document.createElement("option");
                option.value = h;
                option.textContent = `${h}:00`;
                hourSelect.appendChild(option);
              }
            });
          </script>
        </select>
      </div>

      <!-- Select Interval -->
      <div class="col-md-3">
        <label for="interval" class="form-label"><b>Interval</b></label>
        <select id="interval" class="form-select">
          <option value="10min">10 minutes</option>
          <option value="30min">30 minutes</option>
          <option value="1h">1 hour</option>
        </select>
      </div>

      <!-- Apply Button -->
      <div class="col-md-3 d-flex align-items-end">
        <button class="btn btn-primary w-100" onclick="fetchHeatmap()">Apply Filter</button>
      </div>
    </div>

    <!-- Heatmap Container -->
    <div id="chart" style="height: 500px; border: 1px solid #ccc;"></div>
  </div>

  <script>
    async function fetchHeatmap() {
      try {
        const res = await fetch("/callback/heatmap");
        const graphJSON = await res.json();
        Plotly.newPlot("chart", graphJSON.data, graphJSON.layout || {});
      } catch (err) {
        alert("Error loading heatmap: " + err.message);
      }
    }

    // Auto-load the map on page load
    window.onload = fetchHeatmap;
  </script>

  <script
    src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-gtEjrD/SeCtmISkJkNUaaKMoLD0//ElJ19smozuHV6z3Iehds+3Ulb9Bn9Plx0x4"
    crossorigin="anonymous"
  ></script>
</body>
</html>
